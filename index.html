<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0">
    <title>JOVI</title>
    <style>
        html, body, #canvas { margin:0; padding:0; border:0; width:100%; height:100%; overflow:hidden; }
        body { background:#000; touch-action:none; }
        #canvas { display:block; width:100%; height:100%; }
        #status { position:absolute; inset:0; background:#000; color:#fff; display:flex; flex-direction:column; justify-content:center; align-items:center; }
        #status-splash { max-width:90%; max-height:70%; object-fit:contain; }
        #status-progress { width:60%; height:20px; margin-top:20px; }
        #status-notice { background:#5b3943; border:1px solid #9b3943; border-radius:8px; padding:1rem; margin:1rem; max-width:80%; text-align:center; }
    </style>
    <link rel="icon" type="image/png" href="index.icon.png">
    <link rel="apple-touch-icon" href="index.apple-touch-icon.png">
    <link rel="manifest" href="index.manifest.json">
</head>
<body>
    <canvas id="canvas"></canvas>

    <div id="status">
        <img id="status-splash" src="index.png" alt="Loading">
        <progress id="status-progress"></progress>
        <div id="status-notice"></div>
    </div>

    <script src="index.js"></script>
    <script>
        const GODOT_CONFIG = {
            "args": [],
            "canvasResizePolicy": 2,
            "experimentalVK": false,
            "focusCanvas": true,
            "executable": "index",                    // nombre sin extensión
            "mainPack": "index.pck",                  // nombre sin extensión
            "fileSizes": {
                "index.wasm": 36145869,               // tamaño ORIGINAL (sin comprimir)
                "index.pck": 14273996                 // tamaño ORIGINAL (sin comprimir)
            },
            // AÑADIMOS ESTO para que use automáticamente .br si el navegador lo soporta
            "brFiles": ["index.wasm.br", "index.pck.br"]
        };

        // Si tienes Threads activado en Godot 4.3+ pon esto en true
        const GODOT_THREADS_ENABLED = true;

        const engine = new Engine(GODOT_CONFIG);

        (function() {
            const statusOverlay   = document.getElementById('status');
            const statusProgress  = document.getElementById('status-progress');
            const statusNotice    = document.getElementById('status-notice');
            let initializing = true;

            function setStatusMode(mode) {
                if (!initializing) return;
                statusProgress.style.display = mode === 'progress' ? 'block' : 'none';
                statusNotice.style.display   = mode === 'notice'   ? 'block' : 'none';
                if (mode === 'hidden') {
                    statusOverlay.style.display = 'none';
                    initializing = false;
                }
            }

            setStatusMode('progress');

            engine.startGame({
                'onProgress': function(current, total) {
                    if (total > 0) {
                        statusProgress.value = current;
                        statusProgress.max   = total;
                    } else {
                        statusProgress.removeAttribute('value');
                        statusProgress.removeAttribute('max');
                    }
                }
            }).then(() => {
                setStatusMode('hidden');
            }, (err) => {
                statusNotice.textContent = (err.message || err || 'Error desconocido');
                setStatusMode('notice');
                console.error(err);
            });
        })();
    </script>
</body>
</html>